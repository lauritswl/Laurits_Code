---
title: "Tutorial_3_Simulation"
author: "Laurits"
date: "2024-02-22"
output: html_document
---
# Q1:
Consider the Binomial(5, 0.4) distribution. By the alias method, we can rewrite it as
$$p = \frac{1}{5} \sum^{5}_{i=1}q^{i}$$
Where each $q^{i}$ is a distribution on two points.
Please derive the $q^{i}$'s (There is no unique solution for this).

We first derive the binomial distribution:
The binomial dist is described as:
$$P[n,r] = \frac{n!}{(n-r)!r!}p^{r}q^{n-r} $$
r: represents the number of randomly selected items. (how many succesfull trials we want out of n)
n: the number of trials or experiments.
p: represents the probability of one specific outcome, success.
q: represents the probability of one specific outcome, failure.
P: probability of r success in n number of trials.


```{r}
Binorm_prob <- function(number_of_trials, selected_items, succes){
  p <- succes
  q <- 1-succes
  returned_prob <- factorial(number_of_trials)/(factorial(number_of_trials-selected_items)*factorial(selected_items))*p^(selected_items)*q^(number_of_trials-selected_items)
  return(returned_prob)
  }
```

```{r}
Binorm_dist <- c()
for (i in 0:5){
  i_prob <- Binorm_prob(5, i, 0.4)
  Binorm_dist <- c(Binorm_dist, i_prob)}
Binorm_dist
Binorm_for_comparinsson <- Binorm_dist
```
## Implementing the Alias method ("squaring the histogram")
I used the algorithm found in:
Tsang W-W., A decision tree algorithm for squaring the histogram in random number generation, Ars Combinatoria, 23A, 291-301, 1987

From since we have 5 binomial draws we have 6 possible values, intergers(0:5) = [0,1,2,3,4,5]
This means our alias table should have 5 distributions.
These 5 distributions should consist of two probabilities that sum to 1/5 = 0.2.

```{r}
N_new_Distributions <- length(Binorm_dist)-1 
New_distribution_table <- list("Distributions" = c(), "Min" = c(), "Max" = c())
for (i in (1:N_new_Distributions)){
  print("Remaning Binomial distribution: ") # Gives output to follow algorithm
  print(Binorm_dist) # Gives an output to follow algorithm
  amount_to_remove_each_i <- 1/N_new_Distributions
  # Define values as readable names
  max_index <- which.max(Binorm_dist) # Find the index of the most likely value 
  min_index <- which.min(Binorm_dist) # Find the index of the least likely value
  print(min_index)
  min_value <- Binorm_dist[min_index] #Find the min value in a readable way
  subtract_from_max <- (amount_to_remove_each_i)-min_value # Find amount to update max value with
  
  # Add values to list
  New_distribution_table[["Distributions"]] <- c(New_distribution_table[["Distributions"]], min_value)
  New_distribution_table[["Min"]] <- c(New_distribution_table[["Min"]], min_index-1)
  New_distribution_table[["Max"]] <- c(New_distribution_table[["Max"]], max_index-1)
  
  # Update old distribution:
  Binorm_dist[max_index] <- Binorm_dist[max_index]-subtract_from_max
  Binorm_dist[min_index] <- 0
  Binorm_dist[Binorm_dist == 0] <-  NA #Make all zeroes to NA's so they dont get picked up by the min function
  print(New_distribution_table)
}

# Scale all distributions so that they are no longer the distributions aren't out of 1/5 anymore
New_distribution_table[["Distributions"]] <- New_distribution_table[["Distributions"]]*5

```

## Simulate from table to check if distribution is correct:
```{r}
N <- 10000
N_unif <- ceiling(5*runif(N))
V_unif <- runif(N)


Alias_method_simulation <- ifelse(V_unif < New_distribution_table[["Distributions"]][N_unif],
                         yes = New_distribution_table[["Min"]][N_unif],
                         no = New_distribution_table[["Max"]][N_unif])


df <- as.data.frame(table(Alias_method_simulation)/N)
df["derived"] <- Binorm_for_comparinsson

# Assign new column names
colnames(df) <- c("Value", "Alias", "Derived") 
df["Difference"] <- df["Derived"]-df["Alias"]
View(df)
```




# Q2
$$Bernoulli \sim \text{if U = unif(0,1)}, \begin{cases} U < p = 0 \\ U \geq p = 0\end{cases}$$
$$X \sim unif\{0, 1, 2, ... , K-1\} == \lfloor K\cdot unif(0,1) \rfloor$$
$x \sim p$, where $p_{i}=\frac{1}{i} - \frac{1}{i+1}$



# Q3
Write pseudo-code that uses the inversion method to generate a random variable having density function:
$$f(x)= \begin{cases}\frac{x-2}{2} \text{, if }2\leq x \leq 3. \\ \frac{2-\frac{x}{3}}{2} \text{, if }3\leq x \leq 6. \end{cases}$$

1. Find the two cases of $f^{-1}(x)$, that is the generalized inverse of the function.
2. Find the range of cases expressed as y of the two distributions:
  2.1: As x increases so does y, this function has a positive slope.
  2.1.1 $f_{1}(2)=\frac{2-2}{2}=\frac{0}{2}$ = $0$
  2.1.2 $f_{1}(3)=\frac{3-2}{2}$ = $\frac{1}{2}$
  2.2: As x increases y decreases, this function has a negative slope.
  2.2.1 $f_{2}(3)=\frac{2-\frac{3}{3}}{2}=\frac{1}{2}$
  2.2.21 $f_{2}(6)=\frac{2-\frac{6}{3}}{2}=\frac{2-2}{2}=\frac{0}{2}= 0
3. Generate $\frac{1}{2}unif(0,1)$, so that we have a uniform distribution of [0:0.5].
4. Set $X'(u) = F_{1_i}^{-1}(u) \text{ & } F_{2_i}^{-1}(u)$, so that two values are generated from each U, X will have the distribution f(x)



# Q4
Consider the density :
$$f(x) = \frac{2}{\pi(1+x^{2})^{2}}$$

and the corresponding cumulative distribution function  
$$F (x) = \frac{1}{2}+\frac{1}{\pi}(\arctan x + \frac{x}{1+x^{2}})$$These functions define the $t$ distribution with 3 degrees of freedom. In this question, we  shall generate from it using numerical inversion. In order to do that, we shall have to work a little to identify a good starting interval for the solution to $F (X) âˆ’ U = 0$

## a)
Prove that when $x \geq 0$,

 
$$ \frac{1}{2}+\frac{1}{\pi}\arctan x \leq F (x) \leq \frac{1}{2}+\frac{2}{\pi}\arctan x$$
When x = 0,
$$F (0) = \frac{1}{2}+\frac{1}{\pi}(\arctan 0 + \frac{0}{1+0^{2}})=\frac{1}{2}$$
When $x = \infty$,
$$F (\infty)-1/2 \rightarrow^{\lim \infty} \frac{1}{\pi}(\arctan \infty + \frac{\infty}{1+\infty^{2}})= \frac{1}{\pi}(\arctan \infty + \frac{\infty}{\infty^{2}})=\frac{1}{\pi}(\arctan \infty + \frac{1}{\infty})=\frac{1}{\pi}(\arctan \infty)=\frac{1}{\pi}(\frac{\pi}{2})=\frac{1}{2}$$
$$F (\infty) = 1$$


Cant find proof of a value inbetween not exceeding limits.


## b)
need to go through the limits proof shown in class






